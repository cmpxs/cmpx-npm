{"version":3,"file":"index.js","sources":["../src/MVC.ts"],"sourcesContent":["import { Componet, CmpxLib, VMComponet, CmpxEvent, VMWatch, Browser, Bind, VMAttr, VMBind, VMEvent, VMManager, IVMContext } from 'cmpx';\r\nexport * from 'cmpx'\r\n\r\ndeclare global {\r\n    /**\r\n     * 声明按需加\r\n     */\r\n    const require: {\r\n        <T>(path: string): T;\r\n        (paths: string[], callback: (...modules: any[]) => void): void;\r\n        ensure: (paths: string[], callback: (require: <T>(path: string) => T) => void, chunckName?: string) => void;\r\n    };\r\n}\r\n\r\nexport abstract class ActionResult {\r\n    readonly $location: ActionLocation;\r\n    abstract onLayout(cb): void;\r\n}\r\n\r\nexport class AsyncResult extends ActionResult {\r\n\r\n    constructor(private callback: (cb: (result: ActionResult | View) => void) => void) { super(); }\r\n\r\n    onLayout(cb) {\r\n        this.callback(function (result: ActionResult) {\r\n            result.onLayout(cb);\r\n        });\r\n    }\r\n}\r\n\r\nexport class ViewResult extends ActionResult {\r\n    constructor(private componetDef: typeof View, private p?:Object) { super(); }\r\n    onLayout(cb) {\r\n        var cp = new this.componetDef();\r\n        this.p && CmpxLib.extend(cp, this.p);\r\n        cb(cp);\r\n    }\r\n}\r\n\r\nexport class RedirectResult extends ActionResult {\r\n\r\n    constructor(private path: string) { super(); }\r\n\r\n    onLayout(cb) {\r\n        this.$location.isForward = true;\r\n        _getActionResult(this.$location.name, this.path, this.$location.$router, cb);\r\n    }\r\n}\r\n\r\nexport class ContorllerResult extends ActionResult {\r\n    constructor(private controllerDef: typeof Controller) { super(); }\r\n    onLayout(cb) {\r\n        cb(this.controllerDef);\r\n    }\r\n}\r\n\r\nexport class WebpackLoaderContorllerResult extends ActionResult {\r\n    constructor(path: string, conctrollerName:string) { super(); }\r\n    onLayout(cb) {\r\n        cb(null);\r\n    }\r\n}\r\n\r\nlet _hashReg = /(#[^#]*)$/,\r\n    _qsRegx = /[\\?]([^#]*)(?:#[^#]*)*$/,\r\n    _urlPartRegx = /^([^?&#]*)/;\r\nexport class ActionLocation {\r\n    /**\r\n     * 将query部分转成Object\r\n     * @param url\r\n     * @param defaultValue \r\n     */\r\n    static qureyStringToObject(url: string, defaultValue?: Object): Object {\r\n        let qs = ActionLocation.getQueryString(url);\r\n        if (qs) {\r\n            let objs = {},\r\n                qList = qs.split('&'),\r\n                itemList;\r\n            CmpxLib.each(qList, function (item, index) {\r\n                if (item) {\r\n                    itemList = item.split('=');\r\n                    objs[itemList[0]] = decodeURIComponent(itemList[1]);\r\n                }\r\n            });\r\n            return defaultValue ? CmpxLib.extend({}, defaultValue, objs) : objs;\r\n        } else\r\n            return defaultValue || {};\r\n    }\r\n\r\n    /**\r\n     * 将Object部分转成query\r\n     * @param url\r\n     * @param obj \r\n     */\r\n    static qureyStringFromObject(url: string, obj: Object): string {\r\n        let qsObj = CmpxLib.extend(ActionLocation.qureyStringToObject(url), obj),\r\n            hash = ActionLocation.getHash(url);\r\n\r\n        url = ActionLocation.getUrlPart(url);\r\n\r\n        let t, qsList = [];\r\n        CmpxLib.eachProp(qsObj, function (item, name) {\r\n            t = (CmpxLib.isObject(item) || CmpxLib.isArray(item)) ? JSON.stringify(item) : item;\r\n            qsList.push([name, '=', t ? encodeURIComponent(t) : '']);\r\n        });\r\n        t = qsList.length > 0 ? ('?' + qsList.join('&')) : ''\r\n        return [url, t, hash].join('');\r\n    }\r\n\r\n    /**\r\n     * 获取query项\r\n     * @param url\r\n     * @param name 如果空为全部query\r\n     */\r\n    static getQueryString(url: string, name?: string): string {\r\n        return name ? ActionLocation.qureyStringToObject(url)[name] :\r\n            (_qsRegx.test(url) ? RegExp.$1 : '');\r\n    }\r\n\r\n    /**\r\n     * 取得hash值, 返回#hash\r\n     * @param url \r\n     */\r\n    static getHash(url: string): string {\r\n        return _hashReg.test(url) ? RegExp.$1 : '';\r\n    }\r\n\r\n    //只取url部\r\n    static getUrlPart(url: string): string {\r\n        return _urlPartRegx.test(url) ? RegExp.$1 : '';\r\n    }\r\n\r\n    /**\r\n     * query项\r\n     * @param url \r\n     * @param name \r\n     * @param value \r\n     */\r\n    static setQueryString(url: string, name: string, value: string): string {\r\n        if (!name) return url;\r\n        let qsObj = ActionLocation.qureyStringToObject(url);\r\n        qsObj[name] = value ? encodeURIComponent(value) : '';\r\n        return ActionLocation.qureyStringFromObject(url, qsObj);\r\n    }\r\n\r\n    static navigate(href: string, target:string, params?:any[]) {\r\n        let router = _getRouter(target);\r\n        router && router.navigate(href, params);\r\n    }\r\n\r\n    static reload(target:string) {\r\n        let router = _getRouter(target);\r\n        router && router.reload();\r\n    }\r\n\r\n    readonly $router: RouterComponet;\r\n    hash: string;\r\n    search: string;\r\n    //是否跳转\r\n    isForward = false;\r\n    constructor(public href: string, public name?: string, router?: RouterComponet) {\r\n        this.hash = ActionLocation.getHash(href);\r\n        this.search = ActionLocation.getQueryString(href);\r\n        this.$router = router;\r\n    }\r\n\r\n    navigate(href: string, target?:string, params?:any[]) {\r\n        this.href = href;\r\n        if (this.$router){\r\n            this.$router.navigate(href, params);\r\n        }\r\n        else\r\n            window.location.replace(href);\r\n    }\r\n\r\n    reload() {\r\n        if (this.$router)\r\n            this.$router.reload();\r\n        else\r\n            window.location.reload(true);\r\n    }\r\n\r\n    private _qureyParams: Object;\r\n    qureyParams(): Object {\r\n        return this._qureyParams || (this._qureyParams = ActionLocation.qureyStringToObject(this.href));\r\n    }\r\n\r\n    onNavigateBefore(cb:(err?:any)=>void){\r\n        cb();\r\n    }\r\n\r\n    onNavigate(){\r\n    }\r\n\r\n    // private p: any;\r\n    // params(p: any) {\r\n    //     if (arguments.length == 0)\r\n    //         return this.p;\r\n    //     else\r\n    //         this.p = p;\r\n    // }\r\n}\r\n\r\nVMManager.parent = function(target:any, context:IVMContext){\r\n    switch(context.type){\r\n        case \"Componet\":\r\n            return target.$controller || _rootController;\r\n        case \"Controller\":\r\n            return target.$parent;\r\n    }\r\n}\r\n\r\nexport let VMView = VMComponet;\r\n\r\nexport class View extends Componet {\r\n    static RootView:View;\r\n    readonly $location: ActionLocation;\r\n    readonly $parentView: View;\r\n    readonly $controller:Controller;\r\n    readonly $root:View;\r\n}\r\n\r\n\r\n// export function WebpackModuleLoader(moduleFile: any, moduleName: string, cb: any): void {\r\n//     if (!CmpxLib.isString(moduleFile)) {\r\n//         moduleFile(cb)\r\n//     }\r\n\r\n// }\r\n\r\n//router内容\r\ninterface IRouterMap {\r\n    [path: string]: IRouter;\r\n}\r\n\r\ninterface IRouter {\r\n    controller: Controller;\r\n    propertyKey: string;\r\n    path: string;\r\n    action: Function;\r\n    init: boolean;\r\n    childs: IRouterMap;\r\n}\r\n\r\nlet _rmPathSplit2 = /[\\\\\\/]{2,}/g,\r\n    _pathSplit = /\\//g,\r\n    _mergePath = function (path1, path2) {\r\n        let path = [path1, path2].join('/').replace(_rmPathSplit2, '/');\r\n        return CmpxLib.trim(path).replace(/\\/$/, '');\r\n    },\r\n    _buildAction = function (controllerDef: typeof Controller, parent?:Controller, appView?:typeof View): IRouterMap {\r\n        let routers: { [path: string]: IRouter } = {},\r\n            actionDec = _getAtionDec(controllerDef.prototype);\r\n\r\n        CmpxLib.eachProp(actionDec, function (item: IActionDec, n: string) {\r\n            if (!item.controller.$parent)\r\n                (item.controller as any).$parent = parent;\r\n            else if (item.controller.$parent != parent)\r\n                throw new Error('此controller已经存在');\r\n            if (appView && !appView.prototype.$controller){\r\n                var target:any = appView.prototype;\r\n                _rootController = target.$controller = item.controller;\r\n                target.$location = new ActionLocation(window.location+'', '');\r\n            }\r\n\r\n            routers[n] = {\r\n                controller: item.controller,\r\n                propertyKey: item.propertyKey,\r\n                path: item.path,\r\n                action: item.action,\r\n                init: false,\r\n                childs: null\r\n            };\r\n            item.index && (routers['&index'] = routers[n]);\r\n        });\r\n\r\n        return routers;\r\n    },\r\n    _getActionResult = function (name: string, path: string, routerCP: RouterComponet, cb: (view: View) => void) {\r\n\r\n        let pathList: string[] = ActionLocation.getUrlPart(path).replace(_rmPathSplit2, '/').replace(/^\\s*\\//, '').split(_pathSplit),\r\n            pathCount = pathList.length,\r\n            maxPos = pathCount - 1,\r\n            location = new _rootLoactionDef(path, name, routerCP);\r\n\r\n        let fn = function (routers: IRouterMap, pathIndex: number, cb) {\r\n            if (!routers) cb(null);\r\n\r\n            let isEnd = (pathIndex == pathCount), //最后并找index\r\n                path: string = isEnd ? '&index' : pathList[pathIndex],\r\n                rItem = routers[path],\r\n                controller = rItem.controller,\r\n                result: ActionResult = rItem ? rItem.action.call(rItem.controller, location) : null;\r\n            if (result) {\r\n                (result as any).$location = location;\r\n                result.onLayout(function (result: any) {\r\n                    if (result) {\r\n                        if (isEnd) {\r\n                            initResult(result, controller);\r\n                            cb(result);\r\n                        } else if (CmpxLib.isClass(result, Controller)) {\r\n                            if (rItem.init) {\r\n                                fn(rItem.childs, pathIndex + 1, cb);\r\n                            } else {\r\n                                rItem.init = true;\r\n                                rItem.childs = _buildAction(result, rItem.controller);\r\n                                fn(rItem.childs, pathIndex + 1, cb);\r\n                            }\r\n                        } else {\r\n                            //如果不是最后的path返回无效资源\r\n                            if (maxPos == pathIndex) {\r\n                                initResult(result, controller);\r\n                                cb(result);\r\n                            } else\r\n                                cb(null);\r\n                        }\r\n                    } else\r\n                        cb(null);\r\n                });\r\n            } else\r\n                cb(null);\r\n        },\r\n        initResult = function (result: any, controller:Controller) {\r\n            if (result instanceof View) {\r\n                let resultV:any = result;\r\n                resultV['$location'] = location;\r\n                resultV['$parentView'] = routerCP && routerCP.$parent;\r\n                resultV['$controller'] = controller;\r\n                resultV['$root'] = _root;\r\n            }\r\n        };\r\n        location.onNavigateBefore(function(err:any){\r\n            let endFn = function(res:any){\r\n                cb.apply(this, arguments);\r\n                location.onNavigate();\r\n            };\r\n            if (err)\r\n                endFn(null);\r\n            else\r\n                fn(_routerAction, 0, endFn);\r\n        });\r\n    };\r\n\r\n/**\r\n * 每个action的内容描述\r\n */\r\ninterface IActionDec {\r\n    propertyKey: string;\r\n    path: string;\r\n    action: Function;\r\n    index: boolean;\r\n    controller:Controller;\r\n}\r\n\r\nlet _actionDecName = '__CtrlActionDecName',\r\n    _setActionDec = function (target: any, p: IActionDec) {\r\n        let actionDec = target[_actionDecName] || (target[_actionDecName] = {});\r\n        actionDec[p.path] = p;\r\n    },\r\n    _getAtionDec = function (controller: Controller, path?: string): IActionDec {\r\n        let actionDec = controller[_actionDecName];\r\n        return arguments.length <= 1 ? actionDec : (actionDec[path] || actionDec[actionDec.index]);\r\n    };\r\n\r\n/**\r\n * 注入模块配置信息\r\n * @param config \r\n */\r\nexport function VMAction(path?: string) {\r\n    let hasPath = arguments.length > 0;\r\n    return function (target: any, propertyKey: string) {\r\n        hasPath || (path = propertyKey);\r\n        _setActionDec(target, {\r\n            path: path,\r\n            propertyKey: propertyKey,\r\n            action: target[propertyKey],\r\n            index:false,\r\n            controller:null\r\n        });\r\n    };\r\n}\r\n\r\nexport interface ICtrlConfig {\r\n    include?: any[];\r\n    index?: string;\r\n    location?:typeof ActionLocation;\r\n}\r\n\r\n/**\r\n * 注入模块配置信息\r\n * @param config \r\n */\r\nexport function VMController(config?: ICtrlConfig) {\r\n    config || (config = {});\r\n    return function (constructor: typeof Controller) {\r\n        let target = constructor.prototype,\r\n            include = config.include || [];\r\n        include = include.concat([RouterComponet, RouterLink]);\r\n\r\n        VMManager.setConfig(target, config);\r\n        VMManager.include(target, {\r\n            name:'',type:'Controller',\r\n            def:constructor\r\n        }, include);\r\n        config.location && VMManager.setVM(target, 'location', config.location);\r\n\r\n        let actionDec = _getAtionDec(target),\r\n            index = config.index || '',\r\n            controller = new constructor();\r\n\r\n        CmpxLib.eachProp(actionDec, function (item: IActionDec) {\r\n            item.index = item.path == index;\r\n            item.controller = controller;\r\n        });\r\n    };\r\n}\r\n\r\nexport class Controller {\r\n    readonly $parent:Controller;\r\n}\r\n\r\nlet _routers = {},\r\n    _getRouter = function (name: string): RouterComponet {\r\n        return _routers[name];\r\n    },\r\n    _removeRouter = function (name: string) {\r\n        _routers[name] = null;\r\n    },\r\n    /**\r\n     * 如果routerName为空，取第一个router\r\n     */\r\n    _getRouterByCP = function (component: Componet, routerName?:string): RouterComponet {\r\n        let childs = component.$children,\r\n            router:RouterComponet;\r\n        CmpxLib.each(childs, function(item){\r\n            if (item instanceof RouterComponet){\r\n                if (!routerName || item.name == routerName){\r\n                    router = item;\r\n                    return false;\r\n                }\r\n            }\r\n        });\r\n        return router;\r\n    },\r\n    _setRouter = function (name: string, router: RouterComponet) {\r\n        _routers[name] = router;\r\n    };\r\n\r\n@VMComponet({\r\n    name: 'router',\r\n    tmpl: function (CmpxLib, Compile, componet, element, subject) {\r\n        Compile.includeRender(function () { return this.render }, null, componet, element, true, subject, null);\r\n    }\r\n})\r\nexport class RouterComponet extends Componet {\r\n    render: any;\r\n    path: string;\r\n    params:any[];\r\n\r\n    @VMAttr('name')\r\n    name: string;\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    navigate(path: string, params?:any[]) {\r\n        this.params = params;\r\n        this.path = path;\r\n        this.$update();\r\n    }\r\n\r\n    reload() {\r\n        this._path += '_';\r\n        this.navigate(this.path);\r\n    }\r\n\r\n    private _path: string;\r\n    private updateRender() {\r\n        this.setRouter();\r\n        this.path && _getActionResult(this.name, this.path, this, (view: View) => {\r\n            if (view){\r\n                this.render = this.$render(view);\r\n                this.$update();\r\n            }\r\n        });\r\n    }\r\n\r\n    private _init = false;\r\n    private setRouter(){\r\n        if(this._init) return;\r\n        this._init = true;\r\n        this.name && _setRouter(this.name, this);\r\n    }\r\n\r\n\r\n    @VMWatch('this.path')\r\n    private change(path){\r\n        this.updateRender();\r\n    }\r\n\r\n    onDispose() {\r\n        this.name && _removeRouter(this.name);\r\n        super.onDispose();\r\n    }\r\n}\r\n\r\nlet _routerAction: IRouterMap,\r\n    _rootController:Controller,\r\n    _rootLoactionDef:typeof ActionLocation,\r\n    _root:View;\r\nexport class MvcBrowser extends Browser {\r\n    bootFromController(controllerDef: typeof Controller, appView: typeof View) {\r\n        //let ctrl = new controllerDef();\r\n        //console.log(ctrl);\r\n        _rootLoactionDef = VMManager.getVM(controllerDef.prototype, 'location');\r\n        _routerAction = _buildAction(controllerDef, null, appView);\r\n        //appView.prototype.$controller\r\n        let app  = View.RootView =  _root = new appView();\r\n        super.boot(app);\r\n    }\r\n}\r\n\r\n@VMBind({ name: 'router-link' })\r\nexport class RouterLink extends Bind {\r\n    constructor(element: HTMLElement) {\r\n        super(element);\r\n    }\r\n\r\n    // onRead(){\r\n    //     super.onRead();\r\n    // }\r\n    @VMAttr('router-link')\r\n    link:string;\r\n\r\n    @VMAttr('router-target')\r\n    targetName:string;\r\n\r\n    @VMEvent()\r\n    click() {\r\n        let routerName = this.targetName,\r\n            router;\r\n        if (routerName) {\r\n            router = _getRouter(routerName);\r\n        } else {\r\n            router = _getRouterByCP(this.$componet);\r\n        }\r\n        if (router) {\r\n            router.path = this.link;\r\n            router.$update();\r\n        }\r\n    }\r\n}"],"names":["tslib_1.__extends","CmpxLib","VMManager","VMComponet","Componet","tslib_1.__decorate","VMAttr","VMWatch","Browser","VMEvent","VMBind","Bind"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAcA;IAAA;KAGC;IAAD,mBAAC;CAAA,IAAA;AAED;IAAiCA,+BAAY;IAEzC,qBAAoB,QAA6D;QAAjF,YAAqF,iBAAO,SAAG;QAA3E,cAAQ,GAAR,QAAQ,CAAqD;;KAAc;IAE/F,8BAAQ,GAAR,UAAS,EAAE;QACP,IAAI,CAAC,QAAQ,CAAC,UAAU,MAAoB;YACxC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;SACvB,CAAC,CAAC;KACN;IACL,kBAAC;CAAA,CATgC,YAAY,GAS5C;AAED;IAAgCA,8BAAY;IACxC,oBAAoB,WAAwB,EAAU,CAAS;QAA/D,YAAmE,iBAAO,SAAG;QAAzD,iBAAW,GAAX,WAAW,CAAa;QAAU,OAAC,GAAD,CAAC,CAAQ;;KAAc;IAC7E,6BAAQ,GAAR,UAAS,EAAE;QACP,IAAI,EAAE,GAAG,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC;QAChC,IAAI,CAAC,CAAC,IAAIC,YAAO,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;QACrC,EAAE,CAAC,EAAE,CAAC,CAAC;KACV;IACL,iBAAC;CAAA,CAP+B,YAAY,GAO3C;AAED;IAAoCD,kCAAY;IAE5C,wBAAoB,IAAY;QAAhC,YAAoC,iBAAO,SAAG;QAA1B,UAAI,GAAJ,IAAI,CAAQ;;KAAc;IAE9C,iCAAQ,GAAR,UAAS,EAAE;QACP,IAAI,CAAC,SAAS,CAAC,SAAS,GAAG,IAAI,CAAC;QAChC,gBAAgB,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;KAChF;IACL,qBAAC;CAAA,CARmC,YAAY,GAQ/C;AAED;IAAsCA,oCAAY;IAC9C,0BAAoB,aAAgC;QAApD,YAAwD,iBAAO,SAAG;QAA9C,mBAAa,GAAb,aAAa,CAAmB;;KAAc;IAClE,mCAAQ,GAAR,UAAS,EAAE;QACP,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;KAC1B;IACL,uBAAC;CAAA,CALqC,YAAY,GAKjD;AAED;IAAmDA,iDAAY;IAC3D,uCAAY,IAAY,EAAE,eAAsB;eAAI,iBAAO;KAAG;IAC9D,gDAAQ,GAAR,UAAS,EAAE;QACP,EAAE,CAAC,IAAI,CAAC,CAAC;KACZ;IACL,oCAAC;CAAA,CALkD,YAAY,GAK9D;AAED,IAAI,QAAQ,GAAG,WAAW;IACtB,OAAO,GAAG,yBAAyB;IACnC,YAAY,GAAG,YAAY,CAAC;AAChC;IA8FI,wBAAmB,IAAY,EAAS,IAAa,EAAE,MAAuB;QAA3D,SAAI,GAAJ,IAAI,CAAQ;QAAS,SAAI,GAAJ,IAAI,CAAS;;QADrD,cAAS,GAAG,KAAK,CAAC;QAEd,IAAI,CAAC,IAAI,GAAG,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QACzC,IAAI,CAAC,MAAM,GAAG,cAAc,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;QAClD,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;KACzB;;;;;;IA5FM,kCAAmB,GAA1B,UAA2B,GAAW,EAAE,YAAqB;QACzD,IAAI,EAAE,GAAG,cAAc,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;QAC5C,IAAI,EAAE,EAAE;YACJ,IAAI,MAAI,GAAG,EAAE,EACT,KAAK,GAAG,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,EACrB,UAAQ,CAAC;YACbC,YAAO,CAAC,IAAI,CAAC,KAAK,EAAE,UAAU,IAAI,EAAE,KAAK;gBACrC,IAAI,IAAI,EAAE;oBACN,UAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oBAC3B,MAAI,CAAC,UAAQ,CAAC,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,UAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;iBACvD;aACJ,CAAC,CAAC;YACH,OAAO,YAAY,GAAGA,YAAO,CAAC,MAAM,CAAC,EAAE,EAAE,YAAY,EAAE,MAAI,CAAC,GAAG,MAAI,CAAC;SACvE;;YACG,OAAO,YAAY,IAAI,EAAE,CAAC;KACjC;;;;;;IAOM,oCAAqB,GAA5B,UAA6B,GAAW,EAAE,GAAW;QACjD,IAAI,KAAK,GAAGA,YAAO,CAAC,MAAM,CAAC,cAAc,CAAC,mBAAmB,CAAC,GAAG,CAAC,EAAE,GAAG,CAAC,EACpE,IAAI,GAAG,cAAc,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QAEvC,GAAG,GAAG,cAAc,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;QAErC,IAAI,CAAC,EAAE,MAAM,GAAG,EAAE,CAAC;QACnBA,YAAO,CAAC,QAAQ,CAAC,KAAK,EAAE,UAAU,IAAI,EAAE,IAAI;YACxC,CAAC,GAAG,CAACA,YAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAIA,YAAO,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC;YACpF,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,GAAG,EAAE,CAAC,GAAG,kBAAkB,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;SAC5D,CAAC,CAAC;QACH,CAAC,GAAG,MAAM,CAAC,MAAM,GAAG,CAAC,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAA;QACrD,OAAO,CAAC,GAAG,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;KAClC;;;;;;IAOM,6BAAc,GAArB,UAAsB,GAAW,EAAE,IAAa;QAC5C,OAAO,IAAI,GAAG,cAAc,CAAC,mBAAmB,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;aACtD,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;KAC5C;;;;;IAMM,sBAAO,GAAd,UAAe,GAAW;QACtB,OAAO,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,EAAE,GAAG,EAAE,CAAC;KAC9C;;IAGM,yBAAU,GAAjB,UAAkB,GAAW;QACzB,OAAO,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,EAAE,GAAG,EAAE,CAAC;KAClD;;;;;;;IAQM,6BAAc,GAArB,UAAsB,GAAW,EAAE,IAAY,EAAE,KAAa;QAC1D,IAAI,CAAC,IAAI;YAAE,OAAO,GAAG,CAAC;QACtB,IAAI,KAAK,GAAG,cAAc,CAAC,mBAAmB,CAAC,GAAG,CAAC,CAAC;QACpD,KAAK,CAAC,IAAI,CAAC,GAAG,KAAK,GAAG,kBAAkB,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;QACrD,OAAO,cAAc,CAAC,qBAAqB,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;KAC3D;IAEM,uBAAQ,GAAf,UAAgB,IAAY,EAAE,MAAa,EAAE,MAAa;QACtD,IAAI,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC;QAChC,MAAM,IAAI,MAAM,CAAC,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;KAC3C;IAEM,qBAAM,GAAb,UAAc,MAAa;QACvB,IAAI,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC;QAChC,MAAM,IAAI,MAAM,CAAC,MAAM,EAAE,CAAC;KAC7B;IAaD,iCAAQ,GAAR,UAAS,IAAY,EAAE,MAAc,EAAE,MAAa;QAChD,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,IAAI,CAAC,OAAO,EAAC;YACb,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;SACvC;;YAEG,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;KACrC;IAED,+BAAM,GAAN;QACI,IAAI,IAAI,CAAC,OAAO;YACZ,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC;;YAEtB,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;KACpC;IAGD,oCAAW,GAAX;QACI,OAAO,IAAI,CAAC,YAAY,KAAK,IAAI,CAAC,YAAY,GAAG,cAAc,CAAC,mBAAmB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;KACnG;IAED,yCAAgB,GAAhB,UAAiB,EAAmB;QAChC,EAAE,EAAE,CAAC;KACR;IAED,mCAAU,GAAV;KACC;IASL,qBAAC;CAAA,IAAA;AAEDC,cAAS,CAAC,MAAM,GAAG,UAAS,MAAU,EAAE,OAAkB;IACtD,QAAO,OAAO,CAAC,IAAI;QACf,KAAK,UAAU;YACX,OAAO,MAAM,CAAC,WAAW,IAAI,eAAe,CAAC;QACjD,KAAK,YAAY;YACb,OAAO,MAAM,CAAC,OAAO,CAAC;KAC7B;CACJ,CAAA;AAED,AAAO,IAAI,MAAM,GAAGC,eAAU,CAAC;AAE/B;IAA0BH,wBAAQ;IAAlC;;KAMC;IAAD,WAAC;CAAA,CANyBI,aAAQ,GAMjC;AAwBD,IAAI,aAAa,GAAG,aAAa;IAC7B,UAAU,GAAG,KAAK;IAKlB,YAAY,GAAG,UAAU,aAAgC,EAAE,MAAkB,EAAE,OAAoB;IAC/F,IAAI,OAAO,GAAgC,EAAE,EACzC,SAAS,GAAG,YAAY,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;IAEtDH,YAAO,CAAC,QAAQ,CAAC,SAAS,EAAE,UAAU,IAAgB,EAAE,CAAS;QAC7D,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO;YACvB,IAAI,CAAC,UAAkB,CAAC,OAAO,GAAG,MAAM,CAAC;aACzC,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,IAAI,MAAM;YACtC,MAAM,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC;QACvC,IAAI,OAAO,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,WAAW,EAAC;YAC1C,IAAI,MAAM,GAAO,OAAO,CAAC,SAAS,CAAC;YACnC,eAAe,GAAG,MAAM,CAAC,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC;YACvD,MAAM,CAAC,SAAS,GAAG,IAAI,cAAc,CAAC,MAAM,CAAC,QAAQ,GAAC,EAAE,EAAE,EAAE,CAAC,CAAC;SACjE;QAED,OAAO,CAAC,CAAC,CAAC,GAAG;YACT,UAAU,EAAE,IAAI,CAAC,UAAU;YAC3B,WAAW,EAAE,IAAI,CAAC,WAAW;YAC7B,IAAI,EAAE,IAAI,CAAC,IAAI;YACf,MAAM,EAAE,IAAI,CAAC,MAAM;YACnB,IAAI,EAAE,KAAK;YACX,MAAM,EAAE,IAAI;SACf,CAAC;QACF,IAAI,CAAC,KAAK,KAAK,OAAO,CAAC,QAAQ,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;KAClD,CAAC,CAAC;IAEH,OAAO,OAAO,CAAC;CAClB;IACD,gBAAgB,GAAG,UAAU,IAAY,EAAE,IAAY,EAAE,QAAwB,EAAE,EAAwB;IAEvG,IAAI,QAAQ,GAAa,cAAc,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,aAAa,EAAE,GAAG,CAAC,CAAC,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC,KAAK,CAAC,UAAU,CAAC,EACxH,SAAS,GAAG,QAAQ,CAAC,MAAM,EAC3B,MAAM,GAAG,SAAS,GAAG,CAAC,EACtB,QAAQ,GAAG,IAAI,gBAAgB,CAAC,IAAI,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC;IAE1D,IAAI,EAAE,GAAG,UAAU,OAAmB,EAAE,SAAiB,EAAE,EAAE;QACzD,IAAI,CAAC,OAAO;YAAE,EAAE,CAAC,IAAI,CAAC,CAAC;QAEvB,IAAI,KAAK,IAAI,SAAS,IAAI,SAAS,CAAC;QAChC,IAAI,GAAW,KAAK,GAAG,QAAQ,GAAG,QAAQ,CAAC,SAAS,CAAC,EACrD,KAAK,GAAG,OAAO,CAAC,IAAI,CAAC,EACrB,UAAU,GAAG,KAAK,CAAC,UAAU,EAC7B,MAAM,GAAiB,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,EAAE,QAAQ,CAAC,GAAG,IAAI,CAAC;QACxF,IAAI,MAAM,EAAE;YACP,MAAc,CAAC,SAAS,GAAG,QAAQ,CAAC;YACrC,MAAM,CAAC,QAAQ,CAAC,UAAU,MAAW;gBACjC,IAAI,MAAM,EAAE;oBACR,IAAI,KAAK,EAAE;wBACP,UAAU,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;wBAC/B,EAAE,CAAC,MAAM,CAAC,CAAC;qBACd;yBAAM,IAAIA,YAAO,CAAC,OAAO,CAAC,MAAM,EAAE,UAAU,CAAC,EAAE;wBAC5C,IAAI,KAAK,CAAC,IAAI,EAAE;4BACZ,EAAE,CAAC,KAAK,CAAC,MAAM,EAAE,SAAS,GAAG,CAAC,EAAE,EAAE,CAAC,CAAC;yBACvC;6BAAM;4BACH,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC;4BAClB,KAAK,CAAC,MAAM,GAAG,YAAY,CAAC,MAAM,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;4BACtD,EAAE,CAAC,KAAK,CAAC,MAAM,EAAE,SAAS,GAAG,CAAC,EAAE,EAAE,CAAC,CAAC;yBACvC;qBACJ;yBAAM;;wBAEH,IAAI,MAAM,IAAI,SAAS,EAAE;4BACrB,UAAU,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;4BAC/B,EAAE,CAAC,MAAM,CAAC,CAAC;yBACd;;4BACG,EAAE,CAAC,IAAI,CAAC,CAAC;qBAChB;iBACJ;;oBACG,EAAE,CAAC,IAAI,CAAC,CAAC;aAChB,CAAC,CAAC;SACN;;YACG,EAAE,CAAC,IAAI,CAAC,CAAC;KAChB,EACD,UAAU,GAAG,UAAU,MAAW,EAAE,UAAqB;QACrD,IAAI,MAAM,YAAY,IAAI,EAAE;YACxB,IAAI,OAAO,GAAO,MAAM,CAAC;YACzB,OAAO,CAAC,WAAW,CAAC,GAAG,QAAQ,CAAC;YAChC,OAAO,CAAC,aAAa,CAAC,GAAG,QAAQ,IAAI,QAAQ,CAAC,OAAO,CAAC;YACtD,OAAO,CAAC,aAAa,CAAC,GAAG,UAAU,CAAC;YACpC,OAAO,CAAC,OAAO,CAAC,GAAG,KAAK,CAAC;SAC5B;KACJ,CAAC;IACF,QAAQ,CAAC,gBAAgB,CAAC,UAAS,GAAO;QACtC,IAAI,KAAK,GAAG,UAAS,GAAO;YACxB,EAAE,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;YAC1B,QAAQ,CAAC,UAAU,EAAE,CAAC;SACzB,CAAC;QACF,IAAI,GAAG;YACH,KAAK,CAAC,IAAI,CAAC,CAAC;;YAEZ,EAAE,CAAC,aAAa,EAAE,CAAC,EAAE,KAAK,CAAC,CAAC;KACnC,CAAC,CAAC;CACN,CAAC;AAaN,IAAI,cAAc,GAAG,qBAAqB;IACtC,aAAa,GAAG,UAAU,MAAW,EAAE,CAAa;IAChD,IAAI,SAAS,GAAG,MAAM,CAAC,cAAc,CAAC,KAAK,MAAM,CAAC,cAAc,CAAC,GAAG,EAAE,CAAC,CAAC;IACxE,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;CACzB;IACD,YAAY,GAAG,UAAU,UAAsB,EAAE,IAAa;IAC1D,IAAI,SAAS,GAAG,UAAU,CAAC,cAAc,CAAC,CAAC;IAC3C,OAAO,SAAS,CAAC,MAAM,IAAI,CAAC,GAAG,SAAS,IAAI,SAAS,CAAC,IAAI,CAAC,IAAI,SAAS,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC;CAC9F,CAAC;;;;;AAMN,kBAAyB,IAAa;IAClC,IAAI,OAAO,GAAG,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC;IACnC,OAAO,UAAU,MAAW,EAAE,WAAmB;QAC7C,OAAO,KAAK,IAAI,GAAG,WAAW,CAAC,CAAC;QAChC,aAAa,CAAC,MAAM,EAAE;YAClB,IAAI,EAAE,IAAI;YACV,WAAW,EAAE,WAAW;YACxB,MAAM,EAAE,MAAM,CAAC,WAAW,CAAC;YAC3B,KAAK,EAAC,KAAK;YACX,UAAU,EAAC,IAAI;SAClB,CAAC,CAAC;KACN,CAAC;CACL;;;;;AAYD,sBAA6B,MAAoB;IAC7C,MAAM,KAAK,MAAM,GAAG,EAAE,CAAC,CAAC;IACxB,OAAO,UAAU,WAA8B;QAC3C,IAAI,MAAM,GAAG,WAAW,CAAC,SAAS,EAC9B,OAAO,GAAG,MAAM,CAAC,OAAO,IAAI,EAAE,CAAC;QACnC,OAAO,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,cAAc,EAAE,UAAU,CAAC,CAAC,CAAC;QAEvDC,cAAS,CAAC,SAAS,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;QACpCA,cAAS,CAAC,OAAO,CAAC,MAAM,EAAE;YACtB,IAAI,EAAC,EAAE,EAAC,IAAI,EAAC,YAAY;YACzB,GAAG,EAAC,WAAW;SAClB,EAAE,OAAO,CAAC,CAAC;QACZ,MAAM,CAAC,QAAQ,IAAIA,cAAS,CAAC,KAAK,CAAC,MAAM,EAAE,UAAU,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;QAExE,IAAI,SAAS,GAAG,YAAY,CAAC,MAAM,CAAC,EAChC,KAAK,GAAG,MAAM,CAAC,KAAK,IAAI,EAAE,EAC1B,UAAU,GAAG,IAAI,WAAW,EAAE,CAAC;QAEnCD,YAAO,CAAC,QAAQ,CAAC,SAAS,EAAE,UAAU,IAAgB;YAClD,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,IAAI,KAAK,CAAC;YAChC,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;SAChC,CAAC,CAAC;KACN,CAAC;CACL;AAED;IAAA;KAEC;IAAD,iBAAC;CAAA,IAAA;AAED,IAAI,QAAQ,GAAG,EAAE;IACb,UAAU,GAAG,UAAU,IAAY;IAC/B,OAAO,QAAQ,CAAC,IAAI,CAAC,CAAC;CACzB;IACD,aAAa,GAAG,UAAU,IAAY;IAClC,QAAQ,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC;CACzB;IAID,cAAc,GAAG,UAAU,SAAmB,EAAE,UAAkB;IAC9D,IAAI,MAAM,GAAG,SAAS,CAAC,SAAS,EAC5B,MAAqB,CAAC;IAC1BA,YAAO,CAAC,IAAI,CAAC,MAAM,EAAE,UAAS,IAAI;QAC9B,IAAI,IAAI,YAAY,cAAc,EAAC;YAC/B,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,IAAI,IAAI,UAAU,EAAC;gBACvC,MAAM,GAAG,IAAI,CAAC;gBACd,OAAO,KAAK,CAAC;aAChB;SACJ;KACJ,CAAC,CAAC;IACH,OAAO,MAAM,CAAC;CACjB;IACD,UAAU,GAAG,UAAU,IAAY,EAAE,MAAsB;IACvD,QAAQ,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC;CAC3B,CAAC;AAQN;IAAoCD,kCAAQ;IAQxC;QAAA,YACI,iBAAO,SACV;QAwBO,WAAK,GAAG,KAAK,CAAC;;KAxBrB;IAED,iCAAQ,GAAR,UAAS,IAAY,EAAE,MAAa;QAChC,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,OAAO,EAAE,CAAC;KAClB;IAED,+BAAM,GAAN;QACI,IAAI,CAAC,KAAK,IAAI,GAAG,CAAC;QAClB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KAC5B;IAGO,qCAAY,GAApB;QAAA,iBAQC;QAPG,IAAI,CAAC,SAAS,EAAE,CAAC;QACjB,IAAI,CAAC,IAAI,IAAI,gBAAgB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,UAAC,IAAU;YACjE,IAAI,IAAI,EAAC;gBACL,KAAI,CAAC,MAAM,GAAG,KAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;gBACjC,KAAI,CAAC,OAAO,EAAE,CAAC;aAClB;SACJ,CAAC,CAAC;KACN;IAGO,kCAAS,GAAjB;QACI,IAAG,IAAI,CAAC,KAAK;YAAE,OAAO;QACtB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,IAAI,IAAI,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;KAC5C;IAIO,+BAAM,GAAd,UAAe,IAAI;QACf,IAAI,CAAC,YAAY,EAAE,CAAC;KACvB;IAED,kCAAS,GAAT;QACI,IAAI,CAAC,IAAI,IAAI,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACtC,iBAAM,SAAS,WAAE,CAAC;KACrB;IA5CDK;QADCC,WAAM,CAAC,MAAM,CAAC;wCACF;IAqCbD;QADCE,YAAO,CAAC,WAAW,CAAC;0CAGpB;IA7CQ,cAAc;QAN1BJ,eAAU,CAAC;YACR,IAAI,EAAE,QAAQ;YACd,IAAI,EAAE,UAAUF,UAAO,EAAE,OAAO,EAAE,QAAQ,EAAE,OAAO,EAAE,OAAO;gBACxD,OAAO,CAAC,aAAa,CAAC,cAAc,OAAO,IAAI,CAAC,MAAM,CAAA,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;aAC3G;SACJ,CAAC;OACW,cAAc,CAmD1B;IAAD,qBAAC;CAAA,CAnDmCG,aAAQ,GAmD3C;AAED,IAAI,aAAyB;IACzB,eAA0B;IAC1B,gBAAsC;IACtC,KAAU,CAAC;AACf;IAAgCJ,8BAAO;IAAvC;;KAUC;IATG,uCAAkB,GAAlB,UAAmB,aAAgC,EAAE,OAAoB;;;QAGrE,gBAAgB,GAAGE,cAAS,CAAC,KAAK,CAAC,aAAa,CAAC,SAAS,EAAE,UAAU,CAAC,CAAC;QACxE,aAAa,GAAG,YAAY,CAAC,aAAa,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;;QAE3D,IAAI,GAAG,GAAI,IAAI,CAAC,QAAQ,GAAI,KAAK,GAAG,IAAI,OAAO,EAAE,CAAC;QAClD,iBAAM,IAAI,YAAC,GAAG,CAAC,CAAC;KACnB;IACL,iBAAC;CAAA,CAV+BM,YAAO,GAUtC;AAGD;IAAgCR,8BAAI;IAChC,oBAAY,OAAoB;eAC5B,kBAAM,OAAO,CAAC;KACjB;IAYD,0BAAK,GAAL;QACI,IAAI,UAAU,GAAG,IAAI,CAAC,UAAU,EAC5B,MAAM,CAAC;QACX,IAAI,UAAU,EAAE;YACZ,MAAM,GAAG,UAAU,CAAC,UAAU,CAAC,CAAC;SACnC;aAAM;YACH,MAAM,GAAG,cAAc,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;SAC3C;QACD,IAAI,MAAM,EAAE;YACR,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;YACxB,MAAM,CAAC,OAAO,EAAE,CAAC;SACpB;KACJ;IAlBDK;QADCC,WAAM,CAAC,aAAa,CAAC;oCACV;IAGZD;QADCC,WAAM,CAAC,eAAe,CAAC;0CACN;IAGlBD;QADCI,YAAO,EAAE;qCAaT;IA3BQ,UAAU;QADtBC,WAAM,CAAC,EAAE,IAAI,EAAE,aAAa,EAAE,CAAC;OACnB,UAAU,CA4BtB;IAAD,iBAAC;CAAA,CA5B+BC,SAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;"}